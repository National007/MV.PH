
@{
    Layout = null;
}
@using MV.PH.Entity;
@using Lib.Data;
@using MV.PH.WebAdmin.Model.PageHelp;
@using MV.PH.WebAdmin.Model.Article;
@using MV.PH.WebAdmin.Inc;
@using MV.PH.WebAdmin.Model.AccountDal
@model PageListModel<P_ArticleEntity>
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link href="/lib/css/H-ui.min.css" rel="stylesheet" type="text/css" />
    <link href="/lib/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
    
    <link href="/lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="/lib/css/pagination.css" rel="stylesheet" />
    <link href="/lib/css/amazeui.css" rel="stylesheet" />
    <link href="/lib/artDialog/ui_dialog.css" rel="stylesheet" />
    <title>资讯列表</title>
</head>
<body>
    @{
        if (string.IsNullOrWhiteSpace(Request.QueryString["divMain"]))   //从文章列表进入
        {
            <nav class="breadcrumb">
                <i class="Hui-iconfont">&#xe67f;</i> 首页
                <span class="c-gray en">&gt;</span> <span id="parentMenu"></span>
                <span class="c-gray en">&gt;</span> <span id="ChildrenMenu"></span>
                <a class="btn btn-success radius r mr-20" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新">
                    <i class="Hui-iconfont">&#xe68f;</i>
                </a>
            </nav>
        }
        else   //从我的桌面或栏目列表进入文章列表
        {
            <nav class="breadcrumb">
                @{
                    if (Convert.ToString(Request.QueryString["divMain"]) == "true")
                    {
                        <a href="/Default/welcome"><i class="Hui-iconfont">&#xe6dc;</i> 返回我的桌面</a>
                    }
                    else
                    {
                        <a href="/Column/List"><i class="Hui-iconfont">&#xe6dc;</i> 返回栏目列表</a>
                    }
                }
                @*<a href="javascript:;" onclick="back()"><i class="Hui-iconfont">&#xe6dc;</i> 返回上一页</a>*@
                <span id="span_nav"></span>
                <a class="btn btn-success radius r mr-20" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新">
                    <i class="Hui-iconfont">&#xe68f;</i>
                </a>
            </nav>
        }

    }
    
    @*@{Html.RenderAction("Index", "BreadCrumbs", new { id = ViewBag.MenuID });}*@
    @{
        var User = Session["user"] as UserEntity;    //管理员信息表
        var Role = ViewData["Role"] as List<RoleEntity>;     //角色信息表
        Article_dal dal = new Article_dal();
    }

    <div class="pd-20">
        <form id="form1" action="">
            @*<input type="hidden" id="MenuID" name="MenuID" value="@ViewBag.MenuID" />*@
            <input type="hidden" id="divMain" name="divMain" value="@Request.QueryString["divMain"]" />
            <input type="hidden" id="timer_type" name="timer_type" value="@Request.QueryString["timer_type"]" />
            <div class="text-c" style="text-align:left;">
                <select class="select_Column select-box inline" id="ColumnTreeID" name="ColumnTreeID">
                    <option value="">所有类别</option>
                    @{
                        SqlDataAccess sda = new SqlDataAccess("default");
                        //父栏目列表
                        var list = ViewData["list"] as List<ColumnEntity>;
                        var strwhere = string.Empty;   // 文章栏目类别查询
                        if (User.IsAdmin == Convert.ToInt32(Post.SuperAdmin))  //超管
                        {
                            strwhere = string.Format(@"select
                                                            A.ColumnID,A.ColumnTreeID,A.ColumnName
                                                         from
                                                            T_Column A where 1=1 ");
                        }
                        else   //普管
                        {
                            if (Role.Count > 0)
                            {
                                string str = string.Empty;
                                foreach (var item in Role)
                                {
                                    str += "'" + item.RoleID + "',";
                                }
                                strwhere = string.Format(@"select
                                                            A.ColumnName,A.ColumnTreeID,A.ColumnID
                                                                from
                                                            T_Column A
	                                                        inner join T_RoleColumnPermission B ON A.ColumnID=B.ColumnID
	                                                        WHERE B.RoleID in ({0})
                                                                ", str.TrimEnd(','));
                            }


                        }

                        foreach (var item in list)
                        {
                            <option value="@item.ColumnTreeID" @(ViewBag.ColumnTreeID == item.ColumnTreeID ? "selected" : "")>&nbsp; &nbsp;    ├@item.ColumnName</option>

                            string sql = string.Format(@"{1} and ColumnParentID='{0}' group by A.ColumnName,A.ColumnTreeID,A.ColumnID,A.SortNumber", item.ColumnID, strwhere);

                            List<ColumnEntity> Column = sda.FindEntities<ColumnEntity>(sql);
                            foreach (var childColumn in Column)
                            {
                                <option value="@childColumn.ColumnTreeID" @(ViewBag.ColumnTreeID == childColumn.ColumnTreeID ? "selected" : "")>&nbsp; &nbsp;  &nbsp; &nbsp;    ├  @childColumn.ColumnName</option>
                                string sql2 = string.Format(@"{1} and ColumnParentID='{0}' group by A.ColumnName,A.ColumnTreeID,A.ColumnID,A.SortNumber", childColumn.ColumnID, strwhere);

                                List<ColumnEntity> Column2 = sda.FindEntities<ColumnEntity>(sql2);
                                foreach (var childColumn2 in Column2)
                                {
                                    <option value="@childColumn2.ColumnTreeID" @(ViewBag.ColumnTreeID == childColumn2.ColumnTreeID ? "selected" : "")>&nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; &nbsp;   ├  @childColumn2.ColumnName</option>
                                }
                            }
                        }

                    }

                </select>
                &nbsp;&nbsp;
                <select class="select_Column select-box inline" id="property" name="property">
                    <option selected value="">所有属性</option>
                    <option value="S_AuditingStatus" @(ViewBag.property == "S_AuditingStatus" ? "selected" : "")>审核通过</option>
                    <option value="U_AuditingStatus" @(ViewBag.property == "U_AuditingStatus" ? "selected" : "")>审核不通过</option>
                    <option value="W_AuditingStatus" @(ViewBag.property == "W_AuditingStatus" ? "selected" : "")>待审核</option>
                    <option value="IsRecommend" @(ViewBag.property == "IsRecommend" ? "selected" : "")>推荐</option>
                    <option value="IsToppest" @(ViewBag.property == "IsToppest" ? "selected" : "")>置顶</option>
                </select>
                &nbsp;&nbsp;
                日期范围：
                <input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" id="logmin" name="StartTime" value="@ViewBag.StartTime" class="Wdate input-text" style="width:120px;" autocomplete="off">
                -
                <input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d'})" id="logmax" name="EndTime" value="@ViewBag.EndTime" class="Wdate input-text" style="width:120px;" autocomplete="off">
                &nbsp;&nbsp;
                <input type="text" name="ArticleTitle" id="ArticleTitle" value="@ViewBag.ArticleTitle" placeholder="标题名称" style="width:250px" class="input-text">
                
                <button class="btn btn-success" type="submit"><i class="Hui-iconfont">&#xe665;</i> 查询</button>
                &nbsp;&nbsp;&nbsp;
                <a class="btn btn-success radius" href="javascript:location.replace(location.href);" title="刷新">
                    <i class="Hui-iconfont">&#xe68f;</i>
                </a>
            </div>
        </form>

        <div class="cl bg-1 bk-gray mt-20" style="border:0px;background:#fff; border-bottom:1px solid #eee;margin-bottom:10px; padding-bottom:5px;">
            <div class="am-btn-group" data-am-button="">
                <a class="am-btn am-btn-default am-btn-xs" href="/Article/Add">
                    <input type="radio" name="options" id="option2">
                    <i class="Hui-iconfont">&#xe600;</i> 新增
                </a>
                @{
                    if (User.IsAdmin == Convert.ToInt32(Post.SuperAdmin))
                    {
                        <a class="am-btn am-btn-default am-btn-xs" href="javascript:;" onclick="DeleteAll()">
                            <input type="radio" name="options" id="option1">
                            <i class="Hui-iconfont">&#xe6e2;</i> 批量删除
                        </a>

                        <a class="am-btn am-btn-default am-btn-xs" href="javascript:;" onclick="pass()">
                            <input type="radio" name="options" id="option3">
                            <i class="Hui-iconfont">&#xe605;</i> 审核通过
                        </a>

                        <a class="am-btn am-btn-default am-btn-xs" href="javascript:;" onclick="Unpass()">
                            <input type="radio" name="options" id="option3">
                            <i class="Hui-iconfont">&#xe60e;</i> 审核不通过
                        </a>
                        
                    }
                }
               

                <div style="float:left;margin-left:15px;display:block">
                    <select class="select_Column select-box inline" id="ColumnID_Copy" name="ColumnID_Copy" onchange="Copy()">
                        <option value="">批量复制…</option>
                        @{

                            foreach (var item in list)
                            {
                                <option value="@item.ColumnID">&nbsp; &nbsp;    ├@item.ColumnName</option>

                                string sql = string.Format(@"{1} and ColumnParentID='{0}' group by A.ColumnName,A.ColumnTreeID,A.ColumnID,A.SortNumber", item.ColumnID, strwhere);

                                List<ColumnEntity> Column = sda.FindEntities<ColumnEntity>(sql);
                                foreach (var childColumn in Column)
                                {
                                    <option value="@childColumn.ColumnID">&nbsp; &nbsp;  &nbsp; &nbsp;    ├  @childColumn.ColumnName</option>
                                    string sql2 = string.Format(@"{1} and ColumnParentID='{0}' group by A.ColumnName,A.ColumnTreeID,A.ColumnID,A.SortNumber", childColumn.ColumnID, strwhere);

                                    List<ColumnEntity> Column2 = sda.FindEntities<ColumnEntity>(sql2);
                                    foreach (var childColumn2 in Column2)
                                    {
                                        <option value="@childColumn2.ColumnID">&nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; &nbsp;   ├  @childColumn2.ColumnName</option>
                                    }
                                }
                            }
                        }

                    </select>
                </div>

                <div style="float:left;margin-left:15px;display:block">
                    <select class="select_Column select-box inline" id="ColumnID_Move" name="ColumnID_Move" onchange="Move()">
                        <option value="">批量移动…</option>
                        @{

                            foreach (var item in list)
                            {
                                <option value="@item.ColumnID">&nbsp; &nbsp;    ├@item.ColumnName</option>

                                string sql = string.Format(@"{1} and ColumnParentID='{0}' group by A.ColumnName,A.ColumnTreeID,A.ColumnID,A.SortNumber", item.ColumnID, strwhere);

                                List<ColumnEntity> Column = sda.FindEntities<ColumnEntity>(sql);
                                foreach (var childColumn in Column)
                                {
                                    <option value="@childColumn.ColumnID">&nbsp; &nbsp;  &nbsp; &nbsp;    ├  @childColumn.ColumnName</option>
                                    string sql2 = string.Format(@"{1} and ColumnParentID='{0}' group by A.ColumnName,A.ColumnTreeID,A.ColumnID,A.SortNumber", childColumn.ColumnID, strwhere);

                                    List<ColumnEntity> Column2 = sda.FindEntities<ColumnEntity>(sql2);
                                    foreach (var childColumn2 in Column2)
                                    {
                                        <option value="@childColumn2.ColumnID">&nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; &nbsp;   ├  @childColumn2.ColumnName</option>
                                    }
                                }
                            }
                        }

                    </select>
                </div>
            </div>
        </div>



        <div style="padding-bottom:50px;">
            <table class="table table-border table-bordered table-bg table-hover">
                <thead>
                    <tr class="text-c">
                        <th width="50">
                            <input type="checkbox" name="online" id="online" value="" onclick="checkAll(this)" />
                        </th>
                        <th width="60">编号</th>
                        <th>标题</th>
                        <th width="100">分类</th>
                        <th width="70">阅读次数</th>
                        <th width="120">发布时间</th>
                        <th width="100">属性</th>
                        <th width="100">审核状态</th>
                        <th width="70">状态</th>
                        @*<th width="80">文章隶属</th>*@
                        @*<th width="80">相关文章</th>*@
                        <th width="120">操作</th>
                    </tr>
                </thead>
                <tbody>

                    @{
                        if (Model.Data.Count < 1)
                        {
                            <tr class="text-c">
                                <td colspan="10" style="text-align:center;font-size:14px;color:#666;">暂无记录!</td>
                            </tr>
                        }

                        var count = (Model.CurrentPageIndex - 1) * Model.PageSize;
                        foreach (var item in Model.Data)
                        {
                            count++;
                            <tr class="text-c">
                                <td><input type="checkbox" value="@item.ArticleInfoID|@item.ColumnID" /></td>
                                <td>@count</td>
                                <td class="text-l">
                                    <a href="/Article/ArticlePreviews?ArticleID=@item.ArticleInfoID&ColumnID=@item.ColumnID" title="@item.ArticleTitle">
                                        <div style="float:left;width:100%;border:0px solid red;">
                                            <span id="span1" style="float:left;width:85%;border:0px solid red;">
                                                <span style="border:0px solid red;position:relative;">

                                                    @*@item.ArticleTitle*@
                                                    @StringHelper.bSubstring(item.ArticleTitle,46, "…")
                                                    <span style="color:red">
                                                        @{
                                                            if (dal.GetSub_Title(item.ColumnID, item.ArticleInfoID) > 0)
                                                            {
                                                                @:(副本)
                                                         }
                                                        }
                                                    </span>
                                                    @*<span style="position:absolute;top:-6px;right:-33px;color:red;">
                            @{
                                if (dal.GetSub_Title(item.ColumnID, item.ArticleInfoID) > 0)
                                {
                                    @:(副本)
                                }
                             }
                        </span>*@
                                                </span>

                                            </span>

                                            <div style="float:right;border:0px solid red;color:#333">
                                                @{
                                                    if (dal.GetAttachCountByArticleInfoID(item.ArticleInfoID) > 0)
                                                    {
                                                        <span style="border:1px solid #DDDDDD;padding:0px 3px;text-align:center;cursor:pointer" title="附件@(dal.GetAttachCountByArticleInfoID(item.ArticleInfoID))个">
                                                            附件@(dal.GetAttachCountByArticleInfoID(item.ArticleInfoID))个
                                                        </span>
                                                    }
                                                }
                                            </div>
                                        </div>
                                        </a>
</td>
                                <td>
                                    @item.ColumnName
                                </td>
                                <td>@item.ReadCount</td>
                                <td>@item.CreateDate.ToString("yyyy-MM-dd HH:mm")</td>
                                <td>
                                    @{
                                        string state1 = "", state2 = "";
                                        if (item.IsToppest == 1)
                                        {
                                            state1 = "selected";
                                        }
                                        if (item.IsRecommend == 1)
                                        {
                                            state2 = "selected";
                                        }
                                    }
                                    <div class="btn-tools">

                                        <a id="rptList1_lbtnIsTop_0" title="设置置顶" class="top @state1" href='javascript:;' onclick="Article_SetTop('@item.ArticleInfoID',this)">
                                            <input type="hidden" id="hid" value="@item.IsToppest" />
                                        </a>

                                        <a id="rptList1_lbtnIsRed_0" title="设置推荐" class="red @state2" href='javascript:;' onclick="Article_Suggest('@item.ArticleInfoID',this)">
                                            <input type="hidden" id="hid" value="@item.IsRecommend" />
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    @{
                                        if (item.AuditingStatus == 2)
                                        {
                                            @:审核通过
                                        }
                                        if (item.AuditingStatus == 1)
                                        {
                                            @:审核不通过
                                        }
                                        if (item.AuditingStatus == 0)
                                        {
                                            @:未审核
                                        }
                                    }
                                </td>
                                <td class="td-status">
                                    @{
                                        if (item.IsEnable == 1)
                                        {
                                            <span class="label label-success radius">已启用</span>
                                        }
                                        else
                                        {
                                            <span class="label radius">已停用</span>
                                        }
                                    }
                                </td>
                                @*<td>
                                            <a href="javascript:;" style="color:red;" title="已复制到@(dal.GetColumnCountByArticleID(item.ArticleInfoID))个栏目" onclick="showartDialog('文章隶属栏目', '/Article/ArticleColumnList?ArticleInfoID=@item.ArticleInfoID','620','610')">
                                               @{
                                                    if (dal.GetColumnCountByArticleID(item.ArticleInfoID) > 0)
                                                    {
                                                        @(dal.GetColumnCountByArticleID(item.ArticleInfoID))
                                                    }
                                                }
                                            </a>
                                    </td>
                                    <td>
                                            <a href="javascript:;" title="相关文章@(dal.GetArticleRrelateByArticleID(item.ArticleInfoID))篇" onclick="showartDialog('文章相关设置', '/Article/ArticleRrelated?ArticleInfoID=@item.ArticleInfoID','600','500')">
                                                @{
                                                    if (dal.GetArticleRrelateByArticleID(item.ArticleInfoID) > 0)
                                                    {
                                                        @(dal.GetArticleRrelateByArticleID(item.ArticleInfoID))
                                                    }
                                                }
                                            </a>

                                    </td>*@
                                <td class="f-14 td-manage">
                                    @{
                                        if (User.IsAdmin == Convert.ToInt32(Post.SuperAdmin))  //超管
                                        {
                                            if (dal.GetOrginal_Title(item.ColumnID, item.ArticleInfoID) > 0)  //原文章
                                            {
                                                <a title="相关文章@(dal.GetArticleRrelateByArticleID(item.ArticleInfoID))篇" href="javascript:;" class="ml-5" onclick="showartDialog('文章相关设置', '/Article/ArticleRrelated?ArticleInfoID=@item.ArticleInfoID','600','500')" style="text-decoration:none;">
                                                    <i class="Hui-iconfont">&#xe61d;</i>
                                                </a>
                                            }

                                        }
                                    }

                                    @{
                                        var icon = "&#xe615;"; //启用
                                        var title = "启用";
                                        if (item.IsEnable == 1)
                                        {
                                            icon = "&#xe631;";  //停用
                                            title = "停用";
                                        }
                                        if (dal.GetOrginal_Title(item.ColumnID, item.ArticleInfoID) > 0)  //原文章
                                        {
                                            <a style="text-decoration:none" onClick="Article_state('@item.ArticleInfoID',this)" class="ml-5" href="javascript:;" title="@title">
                                                <input type="hidden" value="@item.IsEnable" />
                                                <i class="Hui-iconfont">@(new HtmlString(icon))</i>
                                            </a>
                                        }

                                    }
                                    <a title="编辑" href="/Article/Edit?ArticleInfoID=@item.ArticleInfoID" class="ml-5" style="text-decoration:none">
                                        <i class="Hui-iconfont">&#xe6df;</i>
                                    </a>


                                    @{
                                        if (User.IsAdmin == Convert.ToInt32(Post.SuperAdmin))  //超管
                                        {
                                            <a style="text-decoration:none" class="ml-5" onClick="article_del('@item.ArticleInfoID','@item.ColumnID')" href="javascript:;" title="删除">
                                                <i class="Hui-iconfont">&#xe6e2;</i>
                                            </a>
                                        }
                                    }



                                </td>
                            </tr>
                                        }
                    }
                </tbody>
            </table>

            <div class="pagelist">
                <div id="PageContent" class="default">
                    <span>共@(Model.TotalItemCount)记录</span>

                    @(new HtmlString(PageUIDisplay.Display(Model.CurrentPageIndex, Model.TotalPageCount, "", 8, "")))
                </div>
            </div>

        </div>
    </div>

    <style type="text/css">
        /* IE下的样式 */
         #span1  {
            width:100%;
            display: block;
            /*overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;*/
        }


    </style>
    <script src="/lib/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="/lib/layer/1.9.3/layer.js"></script>
    <script type="text/javascript" src="/lib/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="/lib/js/H-ui.js"></script>
    <script type="text/javascript" src="/lib/js/H-ui.admin.js"></script>
    <script type="text/javascript" src="/lib/js/Common.js"></script>
    <script src="/lib/artDialog/dialog_plus_min.js"></script>
    <script type="text/javascript">
        /*资讯-批量删除*/
        function DeleteAll() {
            var chk = $(":checkbox");
            var chkcount = 0;
            var chkstring = "";
            for (var i = 0; i < chk.length; i++) {
                if (chk[i].checked && chk[i].id != "online") {
                    chkcount++;
                    chkstring += chk[i].value + ",";
                }
            }
            if (chkcount > 0) {

                top.dialog({
                    title: '提示',
                    width: "300px",
                    content: '您已选中' + chkcount + '条记录,确认要删除吗？',
                    okValue: '确定',
                    ok: function () {

                        var v = {};
                        v.ArticleIDstring = chkstring;
                        $.post("/Article/DelArticle", v, function (r) {

                            if (r.Status > 0) {
                                layer.msg(r.Message, { icon: 1, time: 1000 }, function (index) {
                                    layer.close(index);
                                    location.href = location.href;
                                });

                            }
                            else {
                                layer.msg(r.Message, { icon: 2, time: 1000 }, function (index) {
                                    layer.close(index);
                                    location.href = location.href;
                                });

                            }
                        });
                    },
                    cancelValue: '取消',
                    cancel: function () { }
                }).showModal();

            }
            else {
                ///正上方弹出提示
                layer.msg('请选择要删除的数据', {
                    offset: 0,
                    shift: 6,
                    time: 3000
                });
            }
        }

        /*文章删除*/
        function article_del(ArticlInfoID, ColumnID) {
            top.dialog({
                title: '提示',
                width: "300px",
                content: '确认要删除吗？',
                okValue: '确定',
                ok: function () {

                    var v = {};
                    v.ArticleIDstring = ArticlInfoID;
                    v.ColumnID = ColumnID;
                    $.post("/Article/DelArticle", v, function (r) {

                        if (r.Status > 0) {

                            layer.msg(r.Message, { icon: 1, time: 1000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });

                        }
                        else {
                            layer.msg(r.Message, { icon: 2, time: 1000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });

                        }
                    });
                },
                cancelValue: '取消',
                cancel: function () { }
            }).showModal();

        }

        //设置置顶
        function Article_SetTop(id, obj) {
            //此处请求后台程序，下方是成功后的前台处理……
            //alert(id + "\n" + $(obj).children().val());
            var v = {};
            v.IsToppest = $(obj).children().val() == 1 ? "0" : "1";
            v.ArticleInfoID = id;
            $.post("/Article/Edit", v, function (r) {
                if (r.status == "y") {
                    if ($(obj).children().val() == 1) {
                        layer.msg('已成功取消置顶!', { icon: 5, time: 2000 }, function (index) {
                            layer.close(index);
                            $(obj).removeClass("selected");
                            $(obj).children().val("0");
                            //location.href = location.href;
                        });
                    }
                    else {
                        layer.msg('文章置顶设置成功!', { icon: 6, time: 2000 }, function (index) {
                            layer.close(index);
                            $(obj).addClass("selected");
                            $(obj).children().val("1");
                            //location.href = location.href;
                        });

                    }

                }
                else {
                    layer.msg(r.message, { icon: 2, time: 1000 }, function (index) {
                        layer.close(index);
                        location.href = location.href;
                    });
                }
            });
        }

        //设置推荐
        function Article_Suggest(id, obj) {
            //此处请求后台程序，下方是成功后的前台处理……
            //alert(id + "\n" + $(obj).children().val());
            var v = {};
            v.IsRecommend = $(obj).children().val() == 1 ? "0" : "1";
            v.ArticleInfoID = id;
            $.post("/Article/Edit", v, function (r) {
                if (r.status == "y") {
                    if ($(obj).children().val() == 1) {
                        layer.msg('已成功取消推荐!', { icon: 5, time: 2000 }, function (index) {
                            layer.close(index);
                            $(obj).removeClass("selected");
                            $(obj).children().val("0");
                            //location.href = location.href;
                        });
                    }
                    else {
                        layer.msg('文章推荐设置成功!', { icon: 6, time: 2000 }, function (index) {
                            layer.close(index);
                            $(obj).addClass("selected");
                            $(obj).children().val("1");
                            //location.href = location.href;
                        });

                    }
                }
                else {
                    layer.msg(r.message, { icon: 2, time: 1000 }, function (index) {
                        layer.close(index);
                        location.href = location.href;
                    });
                }
            });
        }

        /*资讯-停用*/
        function Article_state(id, obj) {
            var title = "确认要启用吗？";
            var msg = "已启用!";
            var enable = 1;
            var icon = 6;
            if ($(obj).children().val() == 1) {
                title = "确认要停用吗？";
                msg = "已停用!";
                enable = 0;
                icon = 5;
            }

            top.dialog({
                title: '提示',
                width: "300px",
                content: '' + title + '',
                okValue: '确定',
                ok: function () {

                    var v = {};
                    v.IsEnable = enable;
                    v.ArticleInfoID = id;
                    $.post("/Article/Edit", v, function (r) {

                        if (r.status == "y") {
                            //var d = dialog({ content: msg, width: "100px" }).show();
                            //setTimeout(function () {
                            //    location.href = location.href;
                            //    d.close().remove();
                            //}, 2000);
                            if ($(obj).children().val() == 1) {  //已停用
                                layer.msg(msg, { icon: 5, time: 2000 }, function (index) {
                                    layer.close(index);
                                    $(obj).attr("title", "启用");
                                    
                                    $(obj).children().next().html("&#xe615;");
                                    $(obj).children().val("0");

                                    $(obj).parent().prev().children().removeClass("label-success");
                                    $(obj).parent().prev().children().text("已停用");
                                    //location.href = location.href;
                                });
                            }
                            else {
                                layer.msg(msg, { icon: 6, time: 2000 }, function (index) {
                                    layer.close(index);
                                   
                                    $(obj).attr("title", "停用");
                                    $(obj).children().next().html("&#xe631;");
                                    $(obj).children().val("1");

                                    $(obj).parent().prev().children().addClass("label-success");
                                    $(obj).parent().prev().children().text("已启用");
                                    //location.href = location.href;
                                });
                            }

                        }
                        else {
                            //var d = dialog({ content: msg, width: "100px" }).show();
                            //setTimeout(function () {
                            //    d.close().remove();
                            //}, 3000);
                            layer.msg(msg, { icon: 2, time: 2000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });
                        }
                    });
                },
                cancelValue: '取消',
                cancel: function () { }
            }).showModal();

        }

        /*文章批量审核通过*/
        function pass() {
            var chk = $(":checkbox");
            var chkcount = 0;
            var chkstring = "";
            for (var i = 0; i < chk.length; i++) {
                if (chk[i].checked && chk[i].id != "online") {
                    chkcount++;
                    chkstring += chk[i].value + ",";
                }
            }
            if (chkcount > 0) {

                top.dialog({
                    title: '提示',
                    width: "400px",
                    content: '您已选中' + chkcount + '条记录,确定要审核通过吗？',
                    okValue: '确定',
                    ok: function () {

                        var v = {};
                        v.ArticleIDstring = chkstring;
                        v.state = "pass";
                        $.post("/Article/Auditing", v, function (r) {

                            if (r.Status > 0) {
                                //var d = dialog({ content: chkcount + "条记录审核通过成功!", width: "100px" }).show();
                                //setTimeout(function () {
                                //    location.href = location.href;
                                //    d.close().remove();
                                //}, 2000);
                                layer.msg(r.Message, { icon: 6, time: 1000 }, function (index) {
                                    layer.close(index);
                                    location.href = location.href;
                                });

                            }
                            else {
                                //var d = dialog({ content: r.Message, width: "200px" }).show();
                                //setTimeout(function () {
                                //    d.close().remove();
                                //}, 3000);
                                layer.msg(r.Message, { icon: 2, time: 1000 }, function (index) {
                                    layer.close(index);
                                    location.href = location.href;
                                });

                            }
                        });
                    },
                    cancelValue: '取消',
                    cancel: function () { }
                }).showModal();

            }
            else {
                parent.dialog({
                    title: '提示',
                    content: '对不起，请选中您要操作的记录！',
                    okValue: '确定',
                    ok: function () { }
                }).showModal();
            }
        }

        /*文章批量审核不通过*/
        function Unpass() {
            var chk = $(":checkbox");
            var chkcount = 0;
            var chkstring = "";
            for (var i = 0; i < chk.length; i++) {
                if (chk[i].checked && chk[i].id != "online") {
                    chkcount++;
                    chkstring += chk[i].value + ",";
                }
            }
            if (chkcount > 0) {

                top.dialog({
                    title: '提示',
                    width: "400px",
                    content: '您已选中' + chkcount + '条记录,确定要审核不通过吗？',
                    okValue: '确定',
                    ok: function () {

                        var v = {};
                        v.ArticleIDstring = chkstring;
                        v.state = "Unpass";
                        $.post("/Article/Auditing", v, function (r) {

                            if (r.Status > 0) {
                                //var d = dialog({ content: chkcount + "条记录审核不通过成功!", width: "100px" }).show();
                                //setTimeout(function () {
                                //    location.href = location.href;
                                //    d.close().remove();
                                //}, 2000);
                                layer.msg(r.Message, { icon: 5, time: 1000 }, function (index) {
                                    layer.close(index);
                                    location.href = location.href;
                                });
                            }
                            else {
                                //var d = dialog({ content: r.Message, width: "200px" }).show();
                                //setTimeout(function () {
                                //    d.close().remove();
                                //}, 3000);
                                layer.msg(r.Message, { icon: 2, time: 1000 }, function (index) {
                                    layer.close(index);
                                    location.href = location.href;
                                });

                            }
                        });
                    },
                    cancelValue: '取消',
                    cancel: function () { }
                }).showModal();

            }
            else {
                parent.dialog({
                    title: '提示',
                    content: '对不起，请选中您要操作的记录！',
                    okValue: '确定',
                    ok: function () { }
                }).showModal();
            }
        }

        /*文章批量复制*/
        function Copy() {
            var chk = $(":checkbox");
            var chkcount = 0;
            var chkstring = "";
            for (var i = 0; i < chk.length; i++) {
                if (chk[i].checked && chk[i].id != "online") {
                    chkcount++;
                    chkstring += chk[i].value + ",";
                }
            }
            if ($("#ColumnID_Copy").val() != "") {
                if (chkcount > 0) {

                    var v = {};
                    v.ArticleIDstring = chkstring;
                    v.ColumnID = $("#ColumnID_Copy").val();
                    $.post("/Article/SingleArticleInColumn", v, function (r) {

                        if (r.Status > 0) {
                            //var d = dialog({ content: "批量移动"+chkcount+"条成功", width: "100px" }).show();
                            //setTimeout(function () {
                            //    location.href = location.href;
                            //    d.close().remove();
                            //}, 2000);
                            layer.msg(r.Message, { icon: 1, time: 1000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });

                        }
                        else {
                            //var d = dialog({ content: r.Message, width: "200px" }).show();
                            //setTimeout(function () {
                            //    d.close().remove();
                            //}, 3000);
                            layer.msg(r.Message, { icon: 2, time: 1000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });
                        }
                    });
                }
                else {
                    ///正上方弹出提示
                    layer.msg('请选择被复制的文章', {
                        offset: 0,
                        shift: 6,
                        time: 3000
                    });
                }
            }
            else {
                ///正上方弹出提示
                layer.msg('请选择复制的栏目', {
                    offset: 0,
                    shift: 6,
                    time: 3000
                });
            }
        }

        /*文章批量移动*/
        function Move() {
            var chk = $(":checkbox");
            var chkcount = 0;
            var chkstring = "";
            for (var i = 0; i < chk.length; i++) {
                if (chk[i].checked && chk[i].id != "online") {
                    chkcount++;
                    chkstring += chk[i].value + ",";
                }
            }
            if ($("#ColumnID_Move").val() != "") {
                if (chkcount > 0) {

                    var v = {};
                    v.ArticleIDstring = chkstring;
                    v.ColumnID = $("#ColumnID_Move").val();
                    $.post("/Article/ArticleMove", v, function (r) {

                        if (r.Status > 0) {
                            //var d = dialog({ content: "批量移动"+chkcount+"条成功", width: "100px" }).show();
                            //setTimeout(function () {
                            //    location.href = location.href;
                            //    d.close().remove();
                            //}, 2000);
                            layer.msg("批量移动" + chkcount + "条成功", { icon: 1, time: 1000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });

                        }
                        else {
                            //var d = dialog({ content: r.Message, width: "200px" }).show();
                            //setTimeout(function () {
                            //    d.close().remove();
                            //}, 3000);
                            layer.msg(r.Message, { icon: 2, time: 1000 }, function (index) {
                                layer.close(index);
                                location.href = location.href;
                            });
                        }
                    });
                }
                else {
                    ///正上方弹出提示
                    layer.msg('请选择被移动的文章', {
                        offset: 0,
                        shift: 6,
                        time: 3000
                    });
                }
            }
            else {
                ///正上方弹出提示
                layer.msg('请选择移动的栏目', {
                    offset: 0,
                    shift: 6,
                    time: 3000
                });
            }
        }
    </script>

</body>
</html>
